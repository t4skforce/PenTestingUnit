from flask import Blueprint, render_template, redirect, request, g, url_for
from flask_login import login_required
from ... import app, db
from forms.sdrform import SdrForm
from subprocess import Popen, PIPE
import os


rtlsdr = Blueprint('rtlsdr', __name__, template_folder='templates', static_url_path='/static', static_folder='../../views/static', url_prefix='/rtlsdr')

@rtlsdr.route('/run.html',methods=['GET','POST'])
@login_required
def run():
    form = SdrForm()
    output = ""
    if form.validate_on_submit():
        os.chdir('/var/log/rtl_sdr')
        proc=Popen(['/bin/bash', '-c', form.command.data],stdout=PIPE,stderr=PIPE)
        stdout,stderr = proc.communicate()
        output = str(stdout)+str(stderr)
    return render_template('run.html',form=form,output=output)
